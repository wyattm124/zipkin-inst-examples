const wrap = require('./lib/index.js')
const {Tracer, ExplicitContext, BatchRecorder, ConsoleRecorder} = require('zipkin')
const {HttpLogger} = require('zipkin-transport-http');

const ctxImpl = new ExplicitContext()
//const recorder = new ConsoleRecorder()

const recorder = new BatchRecorder({
  logger: new HttpLogger({
    //endpoint: 'http://localhost:9411/api/v1/spans'
    endpoint: 'http://169.44.120.105:9411/api/v1/spans'
  })
});

const tracer = new Tracer({ctxImpl, recorder})

const openwhisk = require('openwhisk')
const options = {apihost: 'openwhisk.ng.bluemix.net', api_key: '596ac566-45b7-4472-b33a-3d1d836dd289:WoBQtb1aEE62eETiAwoy1Led6OQGCH3eagUfD9EQLZRCecs8Cm6PqG2LOzhpCoKs'};
const ow = wrap(openwhisk(options), {
  tracer, serviceName: "sample"
});

exports.main = wrap(function (params) {
  return ow.actions.invoke({actionName: 'greeting-with-parameter', blocking: true})
}, {tracer, serviceName: 'sample'})

exports.static = wrap(function (params) {
  return {'message': 'Hello'}
}, {tracer, serviceName: 'sample'})

exports.main({})
